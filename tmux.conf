#Justyn's tmux config
# Justyn Shull <justyns <at> justynshull.com>

#URL References I used to create this config:
# http://mutelight.org/articles/practical-tmux
# https://bbs.archlinux.org/viewtopic.php?id=84157
# http://blog.hawkhost.com/2010/06/28/tmux-the-terminal-multiplexer/
# http://blog.hawkhost.com/2010/07/02/tmux-%E2%80%93-the-terminal-multiplexer-part-2/
# http://cheasy.de/tmux.pdf
# http://www.edschmalzle.com/2010/09/29/getting-into-tmux/
# http://tonkersten.com/2011/07/104-switching-to-tmux/
# http://www.linuxized.com/2010/05/switching-from-gnu-screen-to-tmux/
# https://wiki.archlinux.org/index.php/Tmux
# https://chadaustin.me/2024/02/tmux-config/
# https://hamvocke.com/blog/a-guide-to-customizing-your-tmux-conf/
# https://github.com/hamvocke/dotfiles/blob/master/tmux/.tmux.conf

## Shortcuts to remember
# Ctrl+a is the 'prefix' / control key
# ctrl+a ?	- displays custom help (clean, searchable shortcut list)
# ctrl+a ctrl+a - switches between last active window
# ctrl+a ,      - renames current window
# ctrl+a |      - splits window vertically
# ctrl+a \      - splits window vertically (alternative)
# ctrl+a -      - splits window horizontally 
# ctrl+a q      - displays numbers on each pane.  Press the number to go to that pane
# ctrl+a o      - cycle through panes
# ctrl+a ctrl+o - cycle panes into the pane you're currently viewing
# ctrl+a n,p    - next/previous windows same as screen
# ctrl+a <space>- changes default layout of your panes (even-horiz, even-vert, etc)
# ctrl+a alt+arrowkeys - resizes current window pane in the direction of the arrow key
# ctrl+a [      - enter copy mode
# ctrl+a a <com>- sends <com> to nested screen or tmux session
# ctrl+a x      - kill a pane(or window)
# ctrl+a w/W    - fzf window switcher popup (replaces default window list)
# ctrl+a "      - choose window (interactive window selector)
# ctrl+a s/S    - fzf session switcher popup (replaces default session list)
# ctrl+a : new -s <session name> - create a new session
# ctrl+a R      - reload / source .tmux.conf
# ctrl+a A      - rename current window
# ctrl+a k      - kill window
# ctrl+a m      - turn on/off monitor_activity for a window(useful for irssi)
# ctrl+a M      - toggle mouse mode
# ctrl+a b/B	- switch prefix from ctrl+a to ctrl+b or back
# ctrl+a X	- break pane to its own window
# ctrl+a j	- bring a window in to current window as a pane (ie: join-pane 0:1)
# ctrl+a T <pos>- move current window to position <pos>
# ctrl+left	- move current window one spot to the left
# ctrl+right	- move current window one spot to the right
# ctrl+a u   	- copy the current window/pane and pipe it to urlview to grab all the urls
# ctrl+a z      - Zoom into the current pane, press again to zoom back out (useful for copying text)
# ctrl+a c-c    - create new window after current window
# shift+left/right - move current window left/right and follow it
#
## Alt key shortcuts (no prefix needed)
# alt+1-9       - switch to window 1-9
# alt+h/j/k/l   - navigate panes (vim-style: left/down/up/right)
# alt+n/m       - navigate panes (left/right)
#
## Shell shortcuts (work outside tmux too)
# ctrl+r        - atuin+fzf history search (popup in tmux, regular fzf outside)
#
## Commands to remember
# :setw synchronize-panes [on|off] - Synchronize panes on the current window, sends input to all of them at the same time.
# :movew -r - Renumber (compact) all windows to fill in gaps.  Can also use movew <num> to renumber the current window to <num>.

##Display##
# Set status bar
# Catppuccin theme configuration
set -g @catppuccin_flavor "frappe" # latte, frappe, macchiato, or mocha
set -g @catppuccin_window_status_style "rounded" # basic, rounded, slanted, custom, or none
set -g @catppuccin_status_left_separator "█"
set -g @catppuccin_status_right_separator "█"

# Window naming logic:
# - If manually renamed: show custom name (#W)  
# - If auto-rename enabled: show directory name for zsh, command name for others
# - Special case for SSH: try to show destination host
set -g @catppuccin_window_text " #{?automatic_rename,#{?#{==:#{pane_current_command},zsh},#{b:pane_current_path},#{pane_current_command}},#W}"
set -g @catppuccin_window_current_text " #{?automatic_rename,#{?#{==:#{pane_current_command},zsh},#{b:pane_current_path},#{pane_current_command}},#W}"


set-option -g status-justify left
set-option -g status-left-length 40
# Note: Catppuccin theme will override these color settings

# Set window notifications
setw -g monitor-activity on
setw -g visual-activity off

# Automatically set window title to command that is running
setw -g automatic-rename on
set-option -g allow-rename on
set-option -g automatic-rename-format '#{?#{==:#{pane_current_command},zsh},#{b:pane_current_path},#{pane_current_command}}'
set-option -g status-interval 1

# Change binding to ctrl+a like screen
unbind-key C-b
set-option -g prefix C-a

# Set tmux to vi mode keys for copy-mode
setw -g mode-keys vi

# Behave the same way as screen with nested multiplexers
#  IE: C-a a <command> sends <command> to inner screen/tmux
bind-key a send-prefix

# Start Window and Pane Numbering at 1
set -g base-index 1
set -g pane-base-index 1

# Rather than constraining window size to the maximum size of any client 
# connected to the *session*, constrain window size to the maximum size of any
# client connected to *that window*. Much more reasonable.
setw -g aggressive-resize on

# no more delay bhetween ctrl+a and a sequence
set -s escape-time 0

# Fix problems with scrolling in some terminals
set -g terminal-overrides 'xterm*:smcup@:rmcup@'

# From  http://tonkersten.com/2011/07/104-switching-to-tmux/ 
set-option -g   history-limit 100000
#set-option -g   pane-active-border-bg default
#set-option -g   pane-active-border-fg red
#set-option -g   pane-border-bg default
#set-option -g   pane-border-fg cyan
#set-window-option -g window-status-format ' #I:#W '
#set-window-option -g window-status-current-format ' (#I:#W) '
set-window-option -g window-status-format '#I:#W#F'
set-window-option -g window-status-current-format '#I:#W#F'

# From http://dev.gentoo.org/~wired/conf/tmux.conf
set-option -g mouse on
set-option -g status-keys vi
set-option -g bell-action any
set-option -g set-titles on
set-option -g set-titles-string '#H:#S.#I.#P #W #T' # window number,program name,active (or not)

##Keybindings
# Change some keybindings to match screen and be easier to use
# Ctrl+a ctrl+a - switch to last active window
# ctrl+a | and - to split the window(horiz and vert)
bind-key C-a last-window
bind a send-prefix

unbind %
bind | split-window -h
bind '\' split-window -h
bind - split-window -v
bind C-c new-window

bind k confirm-before "kill-window"
bind C-k confirm-before "kill-window"
bind m setw monitor-activity

bind M set -g mouse
#bind s list-sessions

# Hide and show window name from status line
#bind '_' setw window-status-format '#I'\; setw window-status-current-format '#I'
#bind '+' setw window-status-format '#I:#W#F'\; setw window-status-current-format '#I:#W#F'

# Easy reloading of config file
bind-key R source-file ~/.tmux.conf \; display-message "source-file done"

# Rename like in screen
bind A command-prompt "rename-window %%"

# Change prefix key from ctrl+a to ctrl+b and back
bind B set-option -g prefix C-a
bind b set-option -g prefix C-b
bind C-x set-option -g prefix C-x

# From https://bbs.archlinux.org/viewtopic.php?id=84157&p=5
# "Some guys in the irc liked a trick I use with tmux and urlview to grab/browse url's 
# from terminal applications run in tmux (most use it with mutt), 
# so I post it here too for reference ..."
bind-key u capture-pane \; save-buffer /tmp/tmux-buffer \; new-window -n "urlview" '$SHELL -c "urlview < /tmp/tmux-buffer"'

# From http://unix.stackexchange.com/questions/14300/tmux-move-window-to-pane
bind-key j command-prompt -p "join pane from:"  "join-pane -s '%%'"
#bind-key s command-prompt -p "send pane to:"  "join-pane -t '%%'"
bind X break-pane


# kill K k 
unbind K
bind K confirm-before "kill-window"
unbind k
bind k confirm-before "kill-window"

# windows ^W w 
unbind ^W
bind ^W list-windows
unbind w
bind '"' choose-window

# From http://superuser.com/questions/343572/how-do-i-reorder-tmux-windows
# c-a T and then a number to move the current window to that position
# Similar to screen's :number
bind-key T command-prompt -p "move window to:"  "swap-window -t '%%'"

# c-a-left arrow to move window left
# c-a-right arrow to move window right
bind-key C-Left swap-window -t -1
bind-key C-Right swap-window -t +1

# Set TERM for tmux sessions - force override any defaults
set -g default-terminal "tmux-256color"

# Enable truecolor support for terminals that support it  
set -ga terminal-overrides ",xterm-ghostty:Tc"
set -ga terminal-overrides ",*256col*:Tc"


# Select windows with alt+number key
bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5
bind-key -n M-6 select-window -t 6
bind-key -n M-7 select-window -t 7
bind-key -n M-8 select-window -t 8
bind-key -n M-9 select-window -t 9

# Use hjkl to move around panes
bind-key -n M-h select-pane -L
bind-key -n M-j select-pane -D
bind-key -n M-k select-pane -U
bind-key -n M-l select-pane -R

bind -n M-n select-pane -L
bind -n M-m select-pane -R

bind -n M-k select-pane -U
bind -n M-j select-pane -D

# Create new window after active window
bind "C-c" new-window -a

# Move current window to the left or right
bind "S-Left" {
  swap-window -t -1
  select-window -t -1
}
bind "S-Right" {
  swap-window -t +1
  select-window -t +1
}

# fzf integration for session and window switching (both upper and lowercase)
bind-key s display-popup -E -w 80% -h 60% "tmux list-sessions -F '#{session_name}: #{session_windows} windows#{?session_attached, (attached),}' | fzf --prompt='Switch to session: ' | cut -d: -f1 | xargs -I {} tmux switch-client -t {}"
bind-key S display-popup -E -w 80% -h 60% "tmux list-sessions -F '#{session_name}: #{session_windows} windows#{?session_attached, (attached),}' | fzf --prompt='Switch to session: ' | cut -d: -f1 | xargs -I {} tmux switch-client -t {}"
bind-key w display-popup -E -w 80% -h 60% "tmux list-windows -F '#{window_index}: #{window_name}#{?window_active, (active),}' | fzf --prompt='Switch to window: ' | cut -d: -f1 | xargs -I {} tmux select-window -t {}"
bind-key W display-popup -E -w 80% -h 60% "tmux list-windows -F '#{window_index}: #{window_name}#{?window_active, (active),}' | fzf --prompt='Switch to window: ' | cut -d: -f1 | xargs -I {} tmux select-window -t {}"

# lazygit popup
bind-key g display-popup -E -xC -yC -w 80% -h 80% -d "#{pane_current_path}" lazygit

# Custom help display (replaces default ? binding)
bind-key ? display-popup -E -w 90% -h 80% "echo 'TMUX SHORTCUTS:

Window/Session Management:
  ctrl+a w/W    - fzf window switcher popup
  ctrl+a s/S    - fzf session switcher popup  
  ctrl+a \"      - choose window (interactive)
  ctrl+a ctrl+a - switch to last active window
  ctrl+a ,      - rename current window

Pane Management:
  ctrl+a |      - split window vertically
  ctrl+a -      - split window horizontally
  ctrl+a z      - zoom/unzoom current pane
  ctrl+a X      - break pane to new window
  ctrl+a j      - join pane from another window

Quick Navigation:
  alt+1-9       - switch to window 1-9
  alt+h/j/k/l   - navigate panes (vim-style)

Other Shortcuts:
  ctrl+a g      - lazygit popup
  ctrl+a R      - reload tmux config
  ctrl+r        - atuin+fzf history search
  shift+left/right - move window left/right

Use arrow keys to scroll, q to quit' | less"

# Load Catppuccin theme (must be at the end)
run ~/.config/tmux/plugins/catppuccin/catppuccin.tmux
